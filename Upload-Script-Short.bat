@echo off
chcp 65001 > nul
echo ========================================
echo  ???????? to GCS
echo ========================================
echo.

set BUCKET_NAME=ai-image-pipeline-scripts

REM ????&??????????????
if "%~1"=="" (
    echo ? ???: ?????????????????????&??????????
    echo.
    echo.
echo ========================================
echo ???? - ??????????????????
echo ========================================
    exit /b 1
)

set FILENAME=%~1

REM ?????????
if not exist "%FILENAME%" (
    echo ? ????????????: %FILENAME%
    echo.
    pause
    exit /b 1
)

REM .txt ?????????
if /I not "%~x1"==".txt" (
    echo ?? ??: .txt ???????????
    echo ????: %~nx1
    echo.
    choice /C YN /M "???????????????"
    if errorlevel 2 exit /b 1
)

echo ?? ????: %~nx1
echo ?? ???????: gs://%BUCKET_NAME%/input-short/
echo.
echo ???????...
echo.

REM ????????????
gsutil cp "%FILENAME%" gs://%BUCKET_NAME%/input-short/ 2>&1

set UPLOAD_RESULT=%errorlevel%

echo.
echo ----------------------------------------
if %UPLOAD_RESULT% equ 0 (
    echo ? ?????????
    echo.
    echo ?? ???????:
    echo    gs://%BUCKET_NAME%/input-short/%~nx1
    echo.
    echo ?? ????:
    echo    gcloud run jobs execute ai-image-pipeline
    echo    --region asia-northeast1 --wait
) else (
    echo ? ???????? (??????: %UPLOAD_RESULT%)
)
echo ----------------------------------------
echo.

pause
